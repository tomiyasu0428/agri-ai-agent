**プロジェクトビジョン:** 「考えるプロセスをなくし、AIが次の一手を指南する」

このドキュメントは、LangChain + MongoDB Atlas を用いた農業管理AIエージェントの開発タスクを管理します。

---

## ✅ タスクチェックリスト

### フェーズ1: 基盤構築 (LangChain + MongoDB)

- [ ]  **T-01** 開発環境セットアップ
    - [ ]  T-01-01 Python仮想環境の構築 (Python 3.9+)
    - [ ]  T-01-02 LangChain、MongoDB関連ライブラリのインストール
    - [ ]  T-01-03 MongoDB Atlas クラスター作成とネットワーク設定
    - [ ]  T-01-04 Google Cloud プロジェクト設定と認証
    - [ ]  T-01-05 環境変数とシークレット管理の設定
- [ ]  **T-02** MongoDB データベース設計・構築
    - [ ]  T-02-01 農場管理用NoSQLスキーマ設計
    - [ ]  T-02-02 既存Airtableスキーマ解析・データ移行スクリプト作成
    - [ ]  T-02-03 MongoDBコレクションとインデックスの作成
    - [ ]  T-02-04 データ検証とサンプルデータ投入
- [ ]  **T-03** LangChain基本エージェント構築
    - [ ]  T-03-01 MongoDB接続クライアントの実装
    - [ ]  T-03-02 基本的なLangChainツール群の実装
    - [ ]  T-03-03 LangChainエージェントの設定とテスト
    - [ ]  T-03-04 ローカル環境での動作確認

### フェーズ2: インテリジェント機能開発

- [ ]  **T-04** 農場管理特化ツールの開発
    - [ ]  T-04-01 今日のタスク取得ツール (`get_today_tasks`)
    - [ ]  T-04-02 作業完了報告ツール (`complete_task`)
    - [ ]  T-04-03 圃場状況確認ツール (`get_field_status`)
    - [ ]  T-04-04 農薬選定支援ツール (`recommend_pesticide`)
    - [ ]  T-04-05 自動スケジューリングツール (`auto_schedule_next`)
    - [ ]  T-04-06 移行データ互換性確保ツール (`legacy_data_access`)
- [ ]  **T-05** 自然言語処理強化
    - [ ]  T-05-01 作業報告の自然言語解析機能
    - [ ]  T-05-02 曖昧な質問に対する文脈推定機能
    - [ ]  T-05-03 農業専門用語の辞書整備
    - [ ]  T-05-04 エラーハンドリングと確認機能
- [ ]  **T-06** 自動化機能の実装
    - [ ]  T-06-01 MongoDB Change Streams監視設定
    - [ ]  T-06-02 防除作業完了時の自動次回スケジュール
    - [ ]  T-06-03 天候データ連携と作業提案調整
    - [ ]  T-06-04 農薬ローテーション自動判定
- [ ]  **T-07** LINE連携の実装
    - [ ]  T-07-01 LINE Messaging API Webhook設定
    - [ ]  T-07-02 LINEユーザー認証とMongoDB紐付け
    - [ ]  T-07-03 リッチメニューとクイック返信の実装
    - [ ]  T-07-04 定期通知機能の実装

### フェーズ3: 本番化・運用

- [ ]  **T-08** デプロイとインフラ
    - [ ]  T-08-01 Google Cloud Functions (Webhook)のデプロイ
    - [ ]  T-08-02 Google Cloud Run (エージェント)のデプロイ
    - [ ]  T-08-03 MongoDB Atlas本番環境設定
    - [ ]  T-08-04 Secret Manager連携とセキュリティ設定
- [ ]  **T-09** テストと評価
    - [ ]  T-09-01 単体テストの作成
    - [ ]  T-09-02 統合テストシナリオの実装
    - [ ]  T-09-03 ユーザー受け入れテスト (UAT)
    - [ ]  T-09-04 パフォーマンステストと最適化
- [ ]  **T-10** 監視と運用
    - [ ]  T-10-01 Google Cloud Monitoring設定
    - [ ]  T-10-02 MongoDB Atlas監視とアラート設定
    - [ ]  T-10-03 ログ収集と分析環境の構築
    - [ ]  T-10-04 バックアップとディザスタリカバリ

---

## フェーズ1: 基盤構築 (LangChain + MongoDB)

**目標:** LangChainとMongoDB Atlasの連携環境を構築し、基本的な農場データ操作を行うエージェントを開発する。

|タスクID|タスク名|関連要件|期間|備考|
|---|---|---|---|---|
|**T-01**|**開発環境セットアップ**|-|1日||
|T-01-01|Python仮想環境の構築|-|2時間|poetry または venv|
|T-01-02|LangChain、MongoDB関連ライブラリのインストール|-|1時間|langchain, pymongo, motor|
|T-01-03|MongoDB Atlas クラスター作成|NF-03|2時間|M0 Free Tier から開始|
|T-01-04|Google Cloud プロジェクト設定|NF-01|2時間|Cloud Functions, Cloud Run有効化|
|T-01-05|環境変数とシークレット管理|NF-01|1時間|.env + Secret Manager|
|**T-02**|**MongoDB データベース設計・構築**|F-01, F-02, F-03|3日||
|T-02-01|NoSQLスキーマ設計|-|1日|圃場中心の統合ドキュメント設計|
|T-02-02|Airtableスキーマ解析・データ移行スクリプト|-|1日|スキーマ+全記入内容の構造変換|
|T-02-03|コレクションとインデックス作成|NF-02|4時間|検索最適化|
|T-02-04|データ検証とサンプル投入|-|4時間|テストデータ準備|
|**T-03**|**LangChain基本エージェント構築**|F-05|2日||
|T-03-01|MongoDB接続クライアント|-|4時間|非同期接続対応|
|T-03-02|基本LangChainツール群|F-01|6時間|CRUD操作ツール|
|T-03-03|エージェント設定とテスト|-|4時間|LLM統合|
|T-03-04|ローカル動作確認|-|2時間|基本質問応答テスト|

---

## フェーズ2: インテリジェント機能開発

**目標:** 農業特化の自然言語処理と自動化機能を実装し、LINE連携を完成させる。

|タスクID|タスク名|関連要件|期間|備考|
|---|---|---|---|---|
|**T-04**|**農場管理特化ツール開発**|F-06|4日||
|T-04-01|今日のタスク取得ツール|F-05-01|4時間|自然言語クエリ対応|
|T-04-02|作業完了報告ツール|F-05-02|6時間|自然言語→DB更新|
|T-04-03|圃場状況確認ツール|F-06-01|4時間|総合状況レポート|
|T-04-04|農薬選定支援ツール|F-06-02|8時間|ローテーション判定|
|T-04-05|自動スケジューリングツール|F-04-01|6時間|次回作業自動生成|
|**T-05**|**自然言語処理強化**|F-05|3日||
|T-05-01|作業報告の自然言語解析|F-05-02|8時間|曖昧表現の構造化|
|T-05-02|文脈推定機能|F-05-01|6時間|対話履歴考慮|
|T-05-03|農業専門用語辞書|-|4時間|農薬名、作業名統一|
|T-05-04|エラーハンドリング|-|4時間|確認フロー|
|**T-06**|**自動化機能実装**|F-04|3日||
|T-06-01|Change Streams監視|F-08|6時間|リアルタイム更新検知|
|T-06-02|自動次回スケジュール|F-04-01|8時間|防除間隔自動計算|
|T-06-03|天候データ連携|F-06-01|4時間|外部API統合|
|T-06-04|農薬ローテーション判定|F-06-02|4時間|過去履歴分析|
|**T-07**|**LINE連携実装**|F-07, F-09|3日||
|T-07-01|Webhook設定|-|4時間|Cloud Functions|
|T-07-02|ユーザー認証|F-07|6時間|LINE ID ↔ 作業者|
|T-07-03|リッチメニュー実装|F-09|6時間|UI/UX設計|
|T-07-04|定期通知機能|F-08|6時間|Cloud Scheduler連携|

---

## フェーズ3: 本番化・運用

**目標:** 本番環境へのデプロイと継続的な運用体制を構築する。

|タスクID|タスク名|関連要件|期間|備考|
|---|---|---|---|---|
|**T-08**|**デプロイとインフラ**|NF-03|2日||
|T-08-01|Cloud Functions デプロイ|-|4時間|Webhook用|
|T-08-02|Cloud Run デプロイ|-|4時間|エージェント用|
|T-08-03|MongoDB Atlas本番設定|NF-03|2時間|冗長化設定|
|T-08-04|セキュリティ設定|NF-01|4時間|Secret Manager統合|
|**T-09**|**テストと評価**|-|3日||
|T-09-01|単体テスト作成|-|6時間|pytest|
|T-09-02|統合テスト実装|-|8時間|エンドツーエンド|
|T-09-03|ユーザー受け入れテスト|-|8時間|実際の農場での検証|
|T-09-04|パフォーマンステスト|NF-02|4時間|応答時間測定|
|**T-10**|**監視と運用**|NF-03|2日||
|T-10-01|Google Cloud Monitoring|NF-03|4時間|メトリクス設定|
|T-10-02|MongoDB Atlas監視|NF-03|2時間|アラート設定|
|T-10-03|ログ収集・分析環境|-|6時間|改善データ収集|
|T-10-04|バックアップ・DR|NF-03|4時間|データ保護|

---

## 技術実装メモ

### 主要ライブラリ

bash

```bash
# Core
langchain==0.1.0
langchain-openai==0.0.5
pymongo==4.6.1
motor==3.3.2

# Cloud
google-cloud-functions-framework==3.5.0
google-cloud-secret-manager==2.18.1
google-cloud-monitoring==2.16.0

# LINE
line-bot-sdk==3.5.0

# Utilities
python-dotenv==1.0.0
pytest==7.4.3
```

### MongoDBコレクション設計案

javascript

```javascript
// daily_schedules コレクション
{
  "_id": ObjectId("..."),
  "日付": "2025-07-08",
  "圃場別予定": [
    {
      "圃場": "鴨川家裏",
      "作業者": "田中",
      "タスク": "防除4回目",
      "ステータス": "完了",
      "使用農薬": ["クプロシールド"],
      "実施時刻": "2025-07-08T09:00:00Z",
      "次回自動生成": true
    }
  ]
}

// field_management コレクション  
{
  "_id": ObjectId("..."),
  "圃場名": "鴨川家裏",
  "現在の作付": {
    "作物": "大豆",
    "品種": "とよまさり",
    "播種日": "2025-05-15",
    "収穫予定": "2025-07-17"
  },
  "防除履歴": [...],
  "農薬使用制限": {...}
}
```